<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="bitcoin.png" type="image/png" sizes="48x48">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Shaft - Ultimate Shame/Flex Machine</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --win: #00d09c;
            --rekt: #ff357f;
            --neutral: #ffcb47;
            --dark: #1e1e30;
            --light: #f0f0f5;
        }
        /* Mobile-first base styles */
    .container {
        width: 94%; 
        margin: 0 auto;
        padding: 20px;
        flex: 1;
    }
    
    /* Desktop adjustments - now properly narrower */
    @media (min-width: 768px) {
        .container {
            width: 75%; /* Reduced from previous values */
            padding: 20px 40px;
            max-width: 1200px; /* Optional: add if you want a maximum width */
        }
        
        .input-card {
            padding: 25px;
        }
        
        .chart-container {
            height: 450px;
        }
    }
    
    /* Large desktop screens - removed duplicate 65% */
    @media (min-width: 1200px) {
        .container {
            width: 65%; /* Now this will properly override the 75% */
            }
        }
        
        /* Simple header image style */
        .header-image {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            display: block;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: var(--dark);
            color: var(--light);
            margin: 0;
            padding: 0;
            text-align: center;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }
        
        h1 {
            color: var(--neutral);
            font-size: 2.8em;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .input-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--neutral);
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }
        
        button {
            background: linear-gradient(45deg, #8e2de2, #4a00e0);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            margin: 20px 0;
            font-weight: bold;
            letter-spacing: 1px;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 45, 226, 0.4);
        }
        
        .result-container {
            background: linear-gradient(135deg, #2b2b4a 0%, #1a1a2e 100%);
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .verdict {
            font-size: 3.5em;
            font-weight: 800;
            margin: 20px 0;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .winning {
            color: var(--win);
            text-shadow: 0 0 10px rgba(0, 208, 156, 0.5);
        }
        
        .shafted {
            color: var(--rekt);
            text-shadow: 0 0 10px rgba(255, 53, 127, 0.5);
        }
        
        .roast {
            font-size: 1.8em;
            margin: 15px 0;
            font-weight: 600;
            min-height: 80px;
        }
        
        .profit-loss {
            font-size: 1.8em;
            margin: 15px 0;
            font-weight: 600;
        }
        
        .chart-container {
            height: 400px;
            margin: 40px 0;
            position: relative;
        }
        
        .chart-error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            padding: 20px;
            background: rgba(255, 53, 127, 0.1);
            border-radius: 8px;
            display: none;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 20px;
        }
        
        .meme-container {
            margin: 25px auto;
            max-width: 400px;
            position: relative;
        }
        
        .meme-img {
            width: 100%;
            border-radius: 12px;
            border: 3px solid rgba(255,255,255,0.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .tier-label {
            font-size: 1.2em;
            color: rgba(255,255,255,0.7);
            margin-top: 5px;
            font-style: italic;
        }
        
        .share-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .share-btn {
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            color: white;
        }
        
        .share-btn img {
            width: 18px;
            height: 18px;
        }
        
        .twitter-btn {
            background: #1DA1F2;
        }
        
        .instagram-btn {
            background: #E1306C;
        }
        
        .reddit-btn {
            background: #FF5700;
        }

        /* Modal styles */
        #tweetModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #2b2b4a 0%, #1a1a2e 100%);
            padding: 30px;
            border-radius: 16px;
            border: 2px solid var(--rekt);
            box-shadow: 0 0 30px rgba(255, 53, 127, 0.3);
            z-index: 1000;
            max-width: 400px;
            width: 90%;
        }
        
        #tweetModal p {
            margin-bottom: 20px;
            font-size: 1.2em;
        }
        
        #tweetNowBtn {
            background: linear-gradient(45deg, #8e2de2, #4a00e0);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        #tweetNowBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 45, 226, 0.4);
        }
        
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 999;
        }

        footer {
            background: rgba(0,0,0,0.3);
            padding: 25px 20px;
            margin-top: 50px;
            border-top: 1px solid #ff357f;
            font-family: 'Rajdhani', sans-serif;
            text-align: center;
            flex-shrink: 0;
        }
        
        footer a {
            color: var(--win);
            text-decoration: none;
            font-weight: bold;
        }
        
        footer a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .verdict {
                font-size: 2.5em;
            }
            
            .roast {
                font-size: 1.4em;
            }

            #tweetModal {
                padding: 20px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <style>
    /* Updated header image style */
    .header-image {
        width: 100%;
        max-height: 150px; /* Reduced from 200px */
        object-fit: contain; /* Changed from 'cover' to show full image */
        display: block;
        margin: 20px 0 auto;
        background-color: var(--dark); /* Match your dark theme */
    }

    @media (max-width: 768px) {
        .header-image {
            max-height: 120px; /* Slightly smaller on mobile */
            margin-top: 15px; /* Smaller margin on mobile */
        }
    }
</style>

<!-- In your body -->
<img src="binance-pictures-b03h7uw1fdbvm4in.jpg" alt="Crypto Shaft Header" class="header-image">
    <!-- ONLY CHANGE: Added header image -->
 
    <div class="container">
        <h1>Crypto Shafting</h1>
        <p>Enter your trades. Get roasted. Cry/laugh. Repeat</p>
        
        <div class="input-grid">
            <div class="input-card">
                <label for="cryptoSelect">Cryptocurrency</label>
                <select id="cryptoSelect">
                    <option value="BTC">Bitcoin (BTC)</option>
                    <option value="ETH">Ethereum (ETH)</option>
                    <option value="SOL">Solana (SOL)</option>
                    <option value="DOGE">Dogecoin (DOGE)</option>
                    <option value="SHIB">Shiba Inu (SHIB)</option>
                    <option value="APE">ApeCoin (APE)</option>
                </select>
            </div>
            
            <div class="input-card">
                <label for="buyPrice">Your Buy Price (USD)</label>
                <input type="number" id="buyPrice" placeholder="e.g. 50000">
            </div>
            
            <div class="input-card">
                <label for="coinAmount">Amount Bought</label>
                <input type="number" id="coinAmount" placeholder="e.g. 0.42" step="0.00000001">
            </div>
            
            <div class="input-card">
                <label for="timeframe">Chart Timeframe</label>
                <select id="timeframe">
                    <option value="day">24 Hours</option>
                    <option value="week">1 Week</option>
                    <option value="month" selected>1 Month</option>
                    <option value="year">1 Year</option>
                </select>
            </div>
        </div>
        
        <button id="calculateBtn">CALCULATE YOUR RECKONING</button>
        
        <div class="result-container">
            <div id="tierLabel" class="tier-label"></div>
            <div id="verdict" class="verdict"></div>
            <div id="roast" class="roast"></div>
            
            <div class="meme-container">
                <img id="memeImg" class="meme-img" src="" style="display:none;">
            </div>
            
            <div id="profitLoss" class="profit-loss"></div>
            <div id="resultDetails" class="result-details"></div>
            
            <div class="share-buttons" id="shareButtons" style="display:none;">
                <button class="share-btn twitter-btn" id="tweetBtn">
                    <img src="https://cdn-icons-png.flaticon.com/512/733/733579.png" alt="Twitter">
                    Tweet This
                </button>
                <button class="share-btn instagram-btn" id="instagramBtn">
                    <img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram">
                    Instagram Story
                </button>
                <button class="share-btn reddit-btn" id="redditBtn">
                    <img src="https://cdn-icons-png.flaticon.com/512/2111/2111589.png" alt="Reddit">
                    Reddit Post
                </button>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="priceChart"></canvas>
            <div class="chart-error"></div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Current Price</h3>
                <p id="currentPrice">Loading...</p>
            </div>
            <div class="stat-card">
                <h3>24h Change</h3>
                <p id="dailyChange">-</p>
            </div>
            <div class="stat-card">
                <h3>Market Cap</h3>
                <p id="marketCap">-</p>
            </div>
            <div class="stat-card">
                <h3>24h Volume</h3>
                <p id="volume">-</p>
            </div>
        </div>
    </div>

    <button id="hiddenTweetBtn" aria-hidden="true" tabindex="-1" style="display: none;"></button>
    
    <div class="modal-overlay" id="modalOverlay"></div>
    <div id="tweetModal">
        <p>üöÄ <strong>Boost your flex/shame!</strong></p>
        <p>Share this roast to get featured on <span style="color: var(--win)">@cryptoshafting</span></p>
        <button id="tweetNowBtn">Tweet Now</button>
    </div>

    <footer>
        <div class="container">
            <p style="margin: 0 0 15px; color: #ffcb47;">
                <strong>Feedback? Death threats? Meme submissions?</strong>
            </p>
            <p style="margin: 0 0 20px;">
                <a href="mailto:contact@cryptoshafting.com">contact@cryptoshafting.com</a>
            </p>
            
            <div style="border-top: 1px dashed rgba(255,255,255,0.1); padding-top: 15px;">
                <p style="margin: 0; font-size: 0.9em;">
                    <span style="color: var(--neutral);">CRYPTO SHAFTING</span> ‚Ä¢ 
                    <span style="opacity: 0.7;">EST. 2023</span> ‚Ä¢ 
                    <span style="opacity: 0.6;">Not financial advice</span>
                </p>
                <p style="margin: 10px 0 0; font-size: 0.8em; opacity: 0.6;">
                    Made with ‚ù§Ô∏è and the tears of bagholders
                </p>
            </div>
        </div>
    </footer>

    <script>
        // ======================
        // ROAST DATABASE
        // ======================
        const gainRoasts = {
            tiny: {
                label: "Barely a Flex (0-20%)",
                memes: [
                    "https://i.imgur.com/mcchicken.jpg",
                    "https://i.imgur.com/chia-pet.jpg",
                    "https://i.imgur.com/gold-star.jpg"
                ],
                roasts: [
                    "Wow, you beat inflation! Gold star for you. üåü",
                    "Congrats, your portfolio grew like a Chia Pet. Slow and underwhelming.",
                    "You made enough to buy a McChicken. Don't spend it all in one place.",
                    "A gain so small, even your bank didn't notice.",
                    "Did you just‚Ä¶ break even? How heroic."
                ],
                hashtags: "#Crypto #Bitcoin #CryptoTrading #Web3 #BarelyFlexing"
            },
            decent: {
                label: "Okay, Now We're Talking (20-50%)",
                memes: [
                    "https://i.imgur.com/shrimp-ramen.jpg",
                    "https://i.imgur.com/guac.jpg",
                    "https://i.imgur.com/401k.jpg"
                ],
                roasts: [
                    "Solid! Now you can afford the good ramen‚Äîshrimp flavor.",
                    "You're outperforming your ex's 401(k). Petty wins count.",
                    "Not bad! Still not 'quit-your-job' money, but 'order-Guac-extra' money.",
                    "You're officially smarter than a savings account. Barely.",
                    "Gains like these make people pretend they knew what they were doing."
                ],
                hashtags: "#Crypto #Bitcoin #CryptoTrading #Web3 #GuacGains"
            },
            big: {
                label: "Alright, Big Shot (50-100%)",
                memes: [
                    "https://i.imgur.com/gme-stock.jpg",
                    "https://i.imgur.com/warren-buffett.jpg",
                    "https://i.imgur.com/diamond-hands.jpg"
                ],
                roasts: [
                    "DOUBLE OR NOTHING? ‚Ä¶Or maybe just take the W?",
                    "You're up more than Bitcoin in 2017. Don't get too cocky.",
                    "Now you can finally afford that one share of GameStop.",
                    "You're winning! ‚Ä¶Unless you compare yourself to the guy who bought ETH at $10.",
                    "Gains so fat, even Warren Buffett side-eyes you."
                ],
                hashtags: "#Crypto #Bitcoin #CryptoTrading #Web3 #ToTheMoon"
            },
            insane: {
                label: "To the Moon or Bust (100%+)",
                memes: [
                    "https://i.imgur.com/moon-landing.jpg",
                    "https://i.imgur.com/irs.jpg",
                    "https://i.imgur.com/crypto-oracle.jpg"
                ],
                roasts: [
                    "üöÄ Congrats, you're either a genius or dangerously lucky.",
                    "You've officially made more in crypto than your parents did in 30 years.",
                    "Time to update your LinkedIn to 'Crypto Oracle' and start a shady Discord.",
                    "You could sell now‚Ä¶ OR YOLO INTO SHIBA 2.0?",
                    "You've won capitalism. Now hide before the IRS finds you."
                ],
                hashtags: "#Crypto #Bitcoin #CryptoTrading #Web3 #100xGang"
            }
        };

        const lossRoasts = {
            papercut: {
                label: "Paper Cut (0-20%)",
                memes: [
                    "https://i.imgur.com/tiny-violin.jpg",
                    "https://i.imgur.com/this-is-fine.jpg",
                    "https://i.imgur.com/tissue.jpg"
                ],
                roasts: [
                    "Aww, did the wittle market hurt you? ü•∫",
                    "This isn't a loss‚Äîit's a strategic discount on your next bad decision.",
                    "You only lost 20%? Cute. Come back when you've truly suffered.",
                    "This is fine. üî• (Everything is fine.)",
                    "You call this a loss? This is just emotional preparation."
                ],
                hashtags: "#Crypto #Bitcoin #CryptoTrading #Web3 #FirstTimeLoser"
            },
            ouch: {
                label: "Okay, Now It Hurts (20-50%)",
                memes: [
                    "https://i.imgur.com/tinder-cringe.jpg",
                    "https://i.imgur.com/bagholder.jpg",
                    "https://i.imgur.com/burning-cash.jpg"
                ],
                roasts: [
                    "RIP your portfolio. Cause of death: hubris.",
                    "You're down more than your self-esteem after a Tinder date.",
                    "Congrats! You've unlocked: The Bagholder Experience.",
                    "You could've lit this money on fire and at least stayed warm.",
                    "Hope you didn't tell anyone you were 'investing'."
                ],
                hashtags: "#Crypto #Bitcoin #CryptoTrading #Web3 #BagholderLife"
            },
            nuclear: {
                label: "Financial Chernobyl (50-100%)",
                memes: [
                    "https://i.imgur.com/ghost-town.jpg",
                    "https://i.imgur.com/crying-wojak.jpg",
                    "https://i.imgur.com/wallstreetbets.jpg"
                ],
                roasts: [
                    "From 'diamond hands' to charcoal fists in record time!",
                    "You just turned $10,000 into a funny story at parties.",
                    "At this point, even WallStreetBets would say 'Damn, that's rough.'",
                    "You're not an investor‚Äîyou're a donor.",
                    "Your portfolio is now a ghost town. Population: You, crying."
                ],
                hashtags: "#Crypto #Bitcoin #CryptoTrading #Web3 #REKT"
            },
            apocalyptic: {
                label: "You Owe the Devil Money (100%+)",
                memes: [
                    "https://i.imgur.com/margin-call.jpg",
                    "https://i.imgur.com/youtube-apology.jpg",
                    "https://i.imgur.com/debt-demon.jpg"
                ],
                roasts: [
                    "You didn't just lose‚Äîyou owe more than your self-worth.",
                    "Margin called so hard, your grandkids are in debt.",
                    "Your broker now owns your firstborn. Congrats!",
                    "You've achieved negative wealth. That's talent.",
                    "At least you can declare bankruptcy and start a YouTube apology arc."
                ],
                hashtags: "#Crypto #Bitcoin #CryptoTrading #Web3 #NGMI"
            }
        };

        // ======================
        // APP LOGIC
        // ======================
        const cryptoSelect = document.getElementById('cryptoSelect');
        const calculateBtn = document.getElementById('calculateBtn');
        const tierLabelElement = document.getElementById('tierLabel');
        const verdictElement = document.getElementById('verdict');
        const roastElement = document.getElementById('roast');
        const profitLossElement = document.getElementById('profitLoss');
        const resultDetailsElement = document.getElementById('resultDetails');
        const currentPriceElement = document.getElementById('currentPrice');
        const dailyChangeElement = document.getElementById('dailyChange');
        const marketCapElement = document.getElementById('marketCap');
        const volumeElement = document.getElementById('volume');
        const memeImg = document.getElementById('memeImg');
        const shareButtons = document.getElementById('shareButtons');
        const ctx = document.getElementById('priceChart').getContext('2d');
        const chartErrorElement = document.querySelector('.chart-error');
        
        let priceChart;
        let currentPrice = null;
        let currentSymbol = 'BTC';
        let dailyChange = 0;
        let historicalData = [];
        let tweetCompleted = false;
        let currentTweetText = '';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            fetchMarketData();
            setInterval(fetchMarketData, 300000); // Refresh every 5 minutes
            
            calculateBtn.addEventListener('click', calculateVerdict);
            cryptoSelect.addEventListener('change', fetchMarketData);
            document.getElementById('timeframe').addEventListener('change', fetchHistoricalData);
            
            // Modal event listeners
            document.getElementById('tweetNowBtn').addEventListener('click', () => {
                autoTweet(currentTweetText);
                hideModal();
            });
            
            document.getElementById('modalOverlay').addEventListener('click', hideModal);
        });

        // Generate smart hashtags
        function generateHashtags(coin, roastTier) {
            // Core tags
            let tags = "#Crypto #Bitcoin #CryptoTrading #Web3";
            
            // Coin-specific tags
            const coinTags = {
                BTC:  "#BTC #StoreOfValue #Halving",
                ETH:  "#ETH #DeFi #SmartContracts",
                SOL:  "#SOL #Solana #NFTs",
                DOGE: "#DOGE #Memecoin #DogeArmy",
                SHIB: "#SHIB #ShibArmy",
                APE:  "#APE #NFT #BoredApe"
            };
            tags += " " + (coinTags[coin] || "");
            
            // Tier-specific tag
            tags += " " + roastTier.hashtags.split(" ").slice(-1)[0];
            
            // Remove duplicates and limit to 8 tags
            return tags.split(" ")
                      .filter((tag, i, arr) => arr.indexOf(tag) === i)
                      .slice(0, 8)
                      .join(" ");
        }

        // Auto-tweet functionality (Twitter only)
        function autoTweet(text) {
            currentTweetText = text;
            const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
            const tweetWindow = window.open(tweetUrl, '_blank', 'width=550,height=420,top=100,left=100');
            
            // Check if window was blocked
            if (!tweetWindow || tweetWindow.closed || typeof tweetWindow.closed == 'undefined') {
                showModal();
            } else {
                tweetCompleted = true;
                // Check every 500ms if window closed
                const checkWindow = setInterval(() => {
                    if (tweetWindow.closed) {
                        clearInterval(checkWindow);
                        if (!tweetCompleted) {
                            showModal();
                        }
                    }
                }, 500);
            }
        }
        
        function showModal() {
            document.getElementById('modalOverlay').style.display = 'block';
            document.getElementById('tweetModal').style.display = 'block';
        }
        
        function hideModal() {
            document.getElementById('modalOverlay').style.display = 'none';
            document.getElementById('tweetModal').style.display = 'none';
        }

        // Fetch market data
        async function fetchMarketData() {
            currentSymbol = cryptoSelect.value;
            
            try {
                const priceResponse = await fetch(`https://min-api.cryptocompare.com/data/price?fsym=${currentSymbol}&tsyms=USD`);
                const priceData = await priceResponse.json();
                
                const marketResponse = await fetch(`https://min-api.cryptocompare.com/data/pricemultifull?fsyms=${currentSymbol}&tsyms=USD`);
                const marketData = await marketResponse.json();
                
                currentPrice = priceData.USD;
                const rawMarketData = marketData.RAW[currentSymbol].USD;
                dailyChange = rawMarketData.CHANGEPCT24HOUR;
                
                currentPriceElement.textContent = `$${currentPrice.toLocaleString()}`;
                dailyChangeElement.textContent = `${dailyChange.toFixed(2)}%`;
                dailyChangeElement.style.color = dailyChange >= 0 ? 'var(--win)' : 'var(--rekt)';
                marketCapElement.textContent = `$${(rawMarketData.MKTCAP / 1000000000).toFixed(2)}B`;
                volumeElement.textContent = `$${(rawMarketData.TOTALVOLUME24HTO / 1000000).toFixed(2)}M`;
                
                fetchHistoricalData();
            } catch (error) {
                console.error("Error fetching data:", error);
                currentPriceElement.textContent = "API Error";
            }
        }

        // Fetch historical data
        async function fetchHistoricalData() {
            const timeframe = document.getElementById('timeframe').value;
            let url, limit;
            
            // Show loading state
            document.getElementById('priceChart').style.opacity = '0.5';
            chartErrorElement.style.display = 'none';
            
            switch(timeframe) {
                case 'day': 
                    url = `https://min-api.cryptocompare.com/data/v2/histohour?fsym=${currentSymbol}&tsym=USD&limit=24`;
                    limit = 24;
                    break;
                case 'week': 
                    url = `https://min-api.cryptocompare.com/data/v2/histohour?fsym=${currentSymbol}&tsym=USD&limit=168`;
                    limit = 168;
                    break;
                case 'month': 
                    url = `https://min-api.cryptocompare.com/data/v2/histoday?fsym=${currentSymbol}&tsym=USD&limit=30`;
                    limit = 30;
                    break;
                case 'year': 
                    url = `https://min-api.cryptocompare.com/data/v2/histoday?fsym=${currentSymbol}&tsym=USD&limit=365`;
                    limit = 365;
                    break;
            }
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                // Ensure we have valid data
                if (data.Data && data.Data.Data) {
                    historicalData = data.Data.Data.slice(0, limit).reverse(); // Reverse to show chronological order
                    updateChart();
                } else {
                    throw new Error("Invalid data format");
                }
            } catch (error) {
                console.error("Error fetching history:", error);
                chartErrorElement.textContent = "Failed to load chart data. Please try again.";
                chartErrorElement.style.display = 'block';
            } finally {
                document.getElementById('priceChart').style.opacity = '1';
            }
        }

        // Update chart with proper initialization and data handling
        function updateChart() {
            if (!historicalData || historicalData.length === 0) return;
            
            const timeframe = document.getElementById('timeframe').value;
            const labels = historicalData.map((item, index) => {
                const date = new Date(item.time * 1000);
                switch(timeframe) {
                    case 'day':
                        return date.getHours() + ':00';
                    case 'week':
                        return date.toLocaleDateString('en-US', { weekday: 'short' });
                    case 'month':
                        return date.toLocaleDateString('en-US', { day: 'numeric', month: 'short' });
                    case 'year':
                        return date.toLocaleDateString('en-US', { month: 'short', year: '2-digit' });
                    default:
                        return date.toLocaleDateString();
                }
            });
            
            const prices = historicalData.map(item => item.close);
            
            const chartData = {
                labels: labels,
                datasets: [{
                    label: `${currentSymbol} Price (USD)`,
                    data: prices,
                    borderColor: '#8e2de2',
                    backgroundColor: 'rgba(142, 45, 226, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.4,
                    fill: true
                }]
            };
            
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: context => `$${context.parsed.y.toLocaleString()}`
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: { 
                            color: 'rgba(255,255,255,0.6)',
                            maxRotation: 45,
                            minRotation: 45
                        }
                    },
                    y: {
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        ticks: {
                            color: 'rgba(255,255,255,0.6)',
                            callback: value => '$' + value.toLocaleString()
                        }
                    }
                }
            };
            
            // Destroy existing chart if it exists
            if (priceChart) {
                priceChart.destroy();
            }
            
            // Create new chart
            priceChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: chartOptions
            });
        }

        // Get emoji based on magnitude
        function getMagnitudeEmoji(percentChange, isGain) {
            const absPercent = Math.abs(percentChange);
            
            if (isGain) {
                if (absPercent > 1000) return "üöÄüöÄüöÄ";
                if (absPercent > 100) return "üöÄüöÄ";
                if (absPercent > 50) return "üöÄ";
                if (absPercent > 20) return "üí∏";
                return "ü™ô";
            } else {
                if (absPercent > 1000) return "üíÄüíÄüíÄ";
                if (absPercent > 100) return "üíÄüíÄ";
                if (absPercent > 50) return "üíÄ";
                if (absPercent > 20) return "üî•";
                return "ü§è";
            }
        }

        // Calculate verdict
        function calculateVerdict() {
            const buyPrice = parseFloat(document.getElementById('buyPrice').value);
            const coinAmount = parseFloat(document.getElementById('coinAmount').value);
            
            if (isNaN(buyPrice) || isNaN(coinAmount)) {
                alert("Please enter valid numbers!");
                return;
            }
            
            if (!currentPrice) {
                alert("Still loading data...");
                return;
            }
            
            const totalInvested = buyPrice * coinAmount;
            const currentValue = currentPrice * coinAmount;
            const profitLoss = currentValue - totalInvested;
            const percentChange = (profitLoss / totalInvested) * 100;
            const isGain = profitLoss >= 0;
            
            // Select roast tier
            const roastTier = selectRoastTier(percentChange, profitLoss);
            const randomRoast = roastTier.roasts[Math.floor(Math.random() * roastTier.roasts.length)];
            const randomMeme = roastTier.memes[Math.floor(Math.random() * roastTier.memes.length)];
            
            // Update UI
            tierLabelElement.textContent = roastTier.label;
            verdictElement.textContent = isGain ? "GAINS! üéâ" : "REKT! üíÄ";
            verdictElement.className = isGain ? "verdict winning" : "verdict shafted";
            roastElement.textContent = randomRoast;
            
            profitLossElement.textContent = `${isGain ? '+' : ''}$${Math.abs(profitLoss).toLocaleString()} (${percentChange >= 0 ? '+' : ''}${percentChange.toFixed(2)}%)`;
            profitLossElement.style.color = isGain ? 'var(--win)' : 'var(--rekt)';
            
            resultDetailsElement.innerHTML = `
                <strong>Invested:</strong> $${totalInvested.toLocaleString()}<br>
                <strong>Current Value:</strong> $${currentValue.toLocaleString()}
            `;
            
            memeImg.src = randomMeme;
            memeImg.style.display = 'block';
            
            // Generate tweet text
            const emoji = getMagnitudeEmoji(percentChange, isGain);
            const tweetText = `${emoji} CRYPTO ${isGain ? "FLEX" : "ROAST"} ${emoji}\n` +
                             `Turned $${totalInvested.toLocaleString()} ${isGain ? "‚Üí" : "‚Üì"} $${currentValue.toLocaleString()} with ${currentSymbol} (${percentChange >= 0 ? '+' : ''}${percentChange.toFixed(2)}%)\n\n` +
                             `"${randomRoast}"\n\n` +
                             `${generateHashtags(currentSymbol, roastTier)}\n` +
                             `cryptoshafting.com\n\n` +
                             `Via @cryptoshafting`;
            
            // Auto-trigger tweet (Twitter only)
            document.getElementById('hiddenTweetBtn').onclick = () => {
                autoTweet(tweetText);
            };
            document.getElementById('hiddenTweetBtn').click();
            
            // Show share buttons
            shareButtons.style.display = 'flex';
            
            // Setup manual share buttons (Instagram/Reddit)
            document.getElementById('tweetBtn').onclick = () => {
                window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`, '_blank');
            };
            
            document.getElementById('instagramBtn').onclick = () => {
                const caption = `${emoji} CRYPTO ${isGain ? "FLEX" : "ROAST"} ${emoji}\n` +
                               `Turned $${totalInvested.toLocaleString()} ${isGain ? "‚Üí" : "‚Üì"} $${currentValue.toLocaleString()}\n` +
                               `"${randomRoast}"\n\n` +
                               `cryptoshafting.com`;
                alert("Screenshot the meme and use this caption:\n\n" + caption);
            };
            
            document.getElementById('redditBtn').onclick = () => {
                const title = isGain 
                    ? `My ${currentSymbol} trade: $${totalInvested.toLocaleString()} ‚Üí $${currentValue.toLocaleString()}`
                    : `My disastrous ${currentSymbol} trade loss`;
                const text = `"${randomRoast}"\n\nVia cryptoshafting.com`;
                window.open(`https://www.reddit.com/submit?title=${encodeURIComponent(title)}&text=${encodeURIComponent(text)}`, '_blank');
            };
            
            // Show modal after 3 seconds if not shared
            setTimeout(() => {
                if (!tweetCompleted) {
                    showModal();
                }
            }, 3000);
        }

        // Select roast tier
        function selectRoastTier(percentChange, dollarChange) {
            const isGain = dollarChange >= 0;
            const absPercent = Math.abs(percentChange);
            const absDollar = Math.abs(dollarChange);
            
            if (isGain) {
                if (absPercent > 1000) return gainRoasts.insane;
                if (absPercent > 100) return gainRoasts.big;
                if (absPercent > 50) return gainRoasts.decent;
                if (absPercent > 20) return gainRoasts.decent;
                return gainRoasts.tiny;
            } else {
                if (absDollar > 100000 || absPercent > 100) return lossRoasts.apocalyptic;
                if (absPercent > 50) return lossRoasts.nuclear;
                if (absPercent > 20) return lossRoasts.ouch;
                return lossRoasts.papercut;
            }
        }
    </script>
</body>
</html>
